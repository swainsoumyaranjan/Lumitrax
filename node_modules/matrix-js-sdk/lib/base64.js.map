{"version":3,"file":"base64.js","names":["encodeBase64","uint8Array","Buffer","from","toString","btoa","Uint8Array","reduce","acc","current","String","fromCharCode","Error","encodeUnpaddedBase64","replace","encodeUnpaddedBase64Url","decodeBase64","base64","atob","itFunc","decoded","i","length","charCodeAt"],"sources":["../src/base64.ts"],"sourcesContent":["/*\nCopyright 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Base64 encoding and decoding utilities\n */\n\n/**\n * Encode a typed array of uint8 as base64.\n * @param uint8Array - The data to encode.\n * @returns The base64.\n */\nexport function encodeBase64(uint8Array: ArrayBuffer | Uint8Array): string {\n    // A brief note on the state of base64 encoding in Javascript.\n    // As of 2023, there is still no common native impl between both browsers and\n    // node. Older Webpack provides an impl for Buffer and there is a polyfill class\n    // for it. There are also plenty of pure js impls, eg. base64-js which has 2336\n    // dependents at current count. Using this would probably be fine although it's\n    // a little under-docced and run by an individual. The node impl works fine,\n    // the browser impl works but predates Uint8Array and so only uses strings.\n    // Right now, switching between native (or polyfilled) impls like this feels\n    // like the least bad option, but... *shrugs*.\n    if (typeof Buffer === \"function\") {\n        return Buffer.from(uint8Array).toString(\"base64\");\n    } else if (typeof btoa === \"function\" && uint8Array instanceof Uint8Array) {\n        // ArrayBuffer is a node concept so the param should always be a Uint8Array on\n        // the browser. We need to check because ArrayBuffers don't have reduce.\n        return btoa(uint8Array.reduce((acc, current) => acc + String.fromCharCode(current), \"\"));\n    } else {\n        throw new Error(\"No base64 impl found!\");\n    }\n}\n\n/**\n * Encode a typed array of uint8 as unpadded base64.\n * @param uint8Array - The data to encode.\n * @returns The unpadded base64.\n */\nexport function encodeUnpaddedBase64(uint8Array: ArrayBuffer | Uint8Array): string {\n    return encodeBase64(uint8Array).replace(/={1,2}$/, \"\");\n}\n\n/**\n * Encode a typed array of uint8 as unpadded base64 using the URL-safe encoding.\n * @param uint8Array - The data to encode.\n * @returns The unpadded base64.\n */\nexport function encodeUnpaddedBase64Url(uint8Array: ArrayBuffer | Uint8Array): string {\n    return encodeUnpaddedBase64(uint8Array).replace(\"+\", \"-\").replace(\"/\", \"_\");\n}\n\n/**\n * Decode a base64 (or base64url) string to a typed array of uint8.\n * @param base64 - The base64 to decode.\n * @returns The decoded data.\n */\nexport function decodeBase64(base64: string): Uint8Array {\n    // See encodeBase64 for a short treatise on base64 en/decoding in JS\n    if (typeof Buffer === \"function\") {\n        return Buffer.from(base64, \"base64\");\n    } else if (typeof atob === \"function\") {\n        const itFunc = function* (): Generator<number> {\n            const decoded = atob(\n                // built-in atob doesn't support base64url: convert so we support either\n                base64.replace(\"-\", \"+\").replace(\"_\", \"/\"),\n            );\n            for (let i = 0; i < decoded.length; ++i) {\n                yield decoded.charCodeAt(i);\n            }\n        };\n        return Uint8Array.from(itFunc());\n    } else {\n        throw new Error(\"No base64 impl found!\");\n    }\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASA,YAAYA,CAACC,UAAoC,EAAU;EACvE;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAI,OAAOC,MAAM,KAAK,UAAU,EAAE;IAC9B,OAAOA,MAAM,CAACC,IAAI,CAACF,UAAU,CAAC,CAACG,QAAQ,CAAC,QAAQ,CAAC;EACrD,CAAC,MAAM,IAAI,OAAOC,IAAI,KAAK,UAAU,IAAIJ,UAAU,YAAYK,UAAU,EAAE;IACvE;IACA;IACA,OAAOD,IAAI,CAACJ,UAAU,CAACM,MAAM,CAAC,CAACC,GAAG,EAAEC,OAAO,KAAKD,GAAG,GAAGE,MAAM,CAACC,YAAY,CAACF,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC;EAC5F,CAAC,MAAM;IACH,MAAM,IAAIG,KAAK,CAAC,uBAAuB,CAAC;EAC5C;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,oBAAoBA,CAACZ,UAAoC,EAAU;EAC/E,OAAOD,YAAY,CAACC,UAAU,CAAC,CAACa,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;AAC1D;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,uBAAuBA,CAACd,UAAoC,EAAU;EAClF,OAAOY,oBAAoB,CAACZ,UAAU,CAAC,CAACa,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC;AAC/E;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASE,YAAYA,CAACC,MAAc,EAAc;EACrD;EACA,IAAI,OAAOf,MAAM,KAAK,UAAU,EAAE;IAC9B,OAAOA,MAAM,CAACC,IAAI,CAACc,MAAM,EAAE,QAAQ,CAAC;EACxC,CAAC,MAAM,IAAI,OAAOC,IAAI,KAAK,UAAU,EAAE;IACnC,MAAMC,MAAM,GAAG,UAAAA,CAAA,EAAgC;MAC3C,MAAMC,OAAO,GAAGF,IAAI;MAChB;MACAD,MAAM,CAACH,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,GAAG,EAAE,GAAG,CAC7C,CAAC;MACD,KAAK,IAAIO,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,OAAO,CAACE,MAAM,EAAE,EAAED,CAAC,EAAE;QACrC,MAAMD,OAAO,CAACG,UAAU,CAACF,CAAC,CAAC;MAC/B;IACJ,CAAC;IACD,OAAOf,UAAU,CAACH,IAAI,CAACgB,MAAM,CAAC,CAAC,CAAC;EACpC,CAAC,MAAM;IACH,MAAM,IAAIP,KAAK,CAAC,uBAAuB,CAAC;EAC5C;AACJ"}